<mat-table #table matSort [dataSource]="dataSource" [trackBy]="workshopTrackBy" [matSortDisableClear]="true">

  <!-- Workshop Type Column -->
  <ng-container matColumnDef="workshopType">
    <mat-header-cell *matHeaderCellDef mat-sort-header> Course Type </mat-header-cell>
    <mat-cell *matCellDef="let workshop">
      <ng-container *ngIf="selectedSfId != workshop.sfId">
        <img src="{{ workshop.image }}">
      </ng-container>

      <ng-container *ngIf="selectedSfId == workshop.sfId">
        <mat-select floatPlaceholder="never" placeholder="Course Type" [(ngModel)]="workshop.type">
          <mat-option *ngFor="let type of CourseTypes" [value]="type">{{ type }}</mat-option>
        </mat-select>
      </ng-container>
    </mat-cell>
  </ng-container>

  <!-- Action Type Column -->
  <ng-container matColumnDef="actionType">
    <mat-header-cell *matHeaderCellDef mat-sort-header> Action Type </mat-header-cell>
    <mat-cell *matCellDef="let workshop"> {{ workshop.status }} </mat-cell>
  </ng-container>

  <!-- Location Column -->
  <ng-container matColumnDef="location">
    <mat-header-cell *matHeaderCellDef mat-sort-header> Location </mat-header-cell>
    <mat-cell *matCellDef="let workshop" fxLayout="column" fxLayoutAlign="center start" class="location-cell">
      <p>{{ workshop.city }}</p>
      <p *ngIf="workshop.country !== ''" [style.font-size]="'12px'">{{ workshop.country }}</p>
    </mat-cell>
  </ng-container>

  <!-- Start Date Column -->
  <ng-container matColumnDef="startDate">
    <mat-header-cell *matHeaderCellDef mat-sort-header> Start Date </mat-header-cell>
    <mat-cell *matCellDef="let workshop">
      <ng-container *ngIf="selectedSfId != workshop.sfId">
        {{ workshop.startDateFormatted }}
      </ng-container>

      <ng-container *ngIf="selectedSfId == workshop.sfId">
        <mat-form-field class="workshop-date-picker-form-field">
          <input matInput [matDatepicker]="startDatePicker" (dateChange)="dateChange($event, workshop, 'startDate')"
            [value]="workshop.startDate" [max]="workshop.endDate">
          <mat-datepicker #startDatePicker [startAt]="workshop.startDate"></mat-datepicker>
          <mat-datepicker-toggle matSuffix [for]="startDatePicker"></mat-datepicker-toggle>
        </mat-form-field>
      </ng-container>
    </mat-cell>
  </ng-container>

  <!-- End Date Column -->
  <ng-container matColumnDef="endDate">
    <mat-header-cell *matHeaderCellDef mat-sort-header> End Date </mat-header-cell>
    <mat-cell *matCellDef="let workshop">
      <ng-container *ngIf="selectedSfId != workshop.sfId">
        {{ workshop.endDateFormatted }}
      </ng-container>

      <ng-container *ngIf="selectedSfId == workshop.sfId">
        <mat-form-field class="workshop-date-picker-form-field">
          <input matInput [matDatepicker]="endDatePicker" (dateChange)="dateChange($event, workshop, 'endDate')"
            [value]="workshop.endDate" [min]="workshop.startDate">
          <mat-datepicker-toggle matSuffix [for]="endDatePicker"></mat-datepicker-toggle>
          <mat-datepicker #endDatePicker [startAt]="workshop.endDate"></mat-datepicker>
        </mat-form-field>
      </ng-container>
    </mat-cell>
  </ng-container>

  <!-- Days Late Column -->
  <ng-container matColumnDef="daysLate">
    <mat-header-cell *matHeaderCellDef> Days Late </mat-header-cell>
    <mat-cell *matCellDef="let workshop"> Due: {{ formatDaysLate(workshop) }} </mat-cell>
  </ng-container>

  <!-- Instructors Column -->
  <ng-container matColumnDef="instructors">
    <mat-header-cell *matHeaderCellDef> Instructor(s) </mat-header-cell>
    <mat-cell *matCellDef="let workshop">
      <em *ngIf="!workshop.instructors.length">No Instructors</em>
      <p [style.margin]="'0'">{{ workshop.instructors.join(', ') }}</p>
    </mat-cell>
  </ng-container>

  <!-- Status Column -->
  <ng-container matColumnDef="status">
    <mat-header-cell *matHeaderCellDef mat-sort-header> Status </mat-header-cell>

    <mat-cell *matCellDef="let workshop">
      <ng-container *ngIf="selectedSfId != workshop.sfId">
        {{ workshop.status }}
      </ng-container>

      <ng-container *ngIf="selectedSfId == workshop.sfId">
        <mat-select floatPlaceholder="never" [(ngModel)]="workshop.status">
          <mat-option *ngFor="let status of Statuses" [value]="status">{{ status }}</mat-option>
        </mat-select>
      </ng-container>
    </mat-cell>
  </ng-container>

  <!-- Verified Column -->
  <ng-container matColumnDef="verified">
    <mat-header-cell *matHeaderCellDef mat-sort-header arrowPosition="center"> Verified? </mat-header-cell>
    <mat-cell *matCellDef="let workshop">
      <mat-icon style="color: #4bae4f" *ngIf="workshop.isVerified">check_circle</mat-icon>
      <mat-icon style="color: #f44336" *ngIf="!workshop.isVerified">cancel</mat-icon>
    </mat-cell>
  </ng-container>

  <!-- Edit Button Column -->
  <ng-container matColumnDef="edit">
    <mat-header-cell *matHeaderCellDef> Edit
      <button class="refresh-button" mat-button (click)="refresh()">
        <mat-icon style="color: #757575">refresh</mat-icon>
      </button>
    </mat-header-cell>
    <mat-cell *matCellDef="let workshop">
      <button (click)="onEdit(workshop.sfId)" mat-raised-button> Edit &ensp;<mat-icon>edit</mat-icon></button>
    </mat-cell>
  </ng-container>

  <!-- Due Date Column -->
  <ng-container matColumnDef="dueDate">
    <mat-header-cell *matHeaderCellDef mat-sort-header> Due Date </mat-header-cell>
    <mat-cell *matCellDef="let workshop"> {{ workshop.dueDate }} </mat-cell>
  </ng-container>

  <!-- Host City Column -->
  <ng-container matColumnDef="hostCity">
    <mat-header-cell *matHeaderCellDef mat-sort-header> Host City </mat-header-cell>
    <mat-cell *matCellDef="let workshop"> {{ workshop.city }} </mat-cell>
  </ng-container>

  <!-- Host Country Column -->
  <ng-container matColumnDef="hostCountry">
    <mat-header-cell *matHeaderCellDef mat-sort-header> Host Country </mat-header-cell>
    <mat-cell *matCellDef="let workshop">{{ workshop.country }} </mat-cell>
  </ng-container>

  <!-- Actions Column -->
  <ng-container matColumnDef="actions">
    <mat-header-cell *matHeaderCellDef mat-sort-header> Actions </mat-header-cell>
    <mat-cell *matCellDef="let workshop" class="actions">

      <!-- Non Editing Mode -->
      <ng-container *ngIf="selectedSfId != workshop.sfId">
        <button mat-mini-fab matTooltip="Edit" aria-label="Edit workshop inline" color="accent" (click)="selectedWorkshop = workshop">
          <mat-icon>edit</mat-icon>
        </button>

        <button mat-mini-fab matTooltip="View Detail" aria-label="View workshop detail" color="accent" (click)="onSelectWorkshop(workshop)">
          <mat-icon>description</mat-icon>
        </button>

        <button mat-mini-fab matTooltip="Delete" aria-label="Delete workshop" color="warn" (click)="delete(workshop)"
          *ngIf="authService.user && authService.user.isAdmin">
          <mat-icon>delete</mat-icon>
        </button>
      </ng-container>

      <!-- Edit Mode -->
      <ng-container *ngIf="selectedSfId == workshop.sfId">
        <button mat-mini-fab matTooltip="Discard Changes" aria-label="Discard changes" color="warn" (click)="selectedWorkshop = null">
          <mat-icon>cancel</mat-icon>
        </button>

        <button mat-mini-fab matTooltip="Save" aria-label="Save changes" color="accent" (click)="save(workshop); this.selectedWorkshop = null;">
          <mat-icon>save</mat-icon>
        </button>
      </ng-container>

    </mat-cell>
  </ng-container>

  <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
  <mat-row [id]="workshop.sfId" *matRowDef="let workshop; columns: displayedColumns;" [ngClass]="{'past-due': isPastDue(workshop),'in-grace-period': isDue(workshop)}"></mat-row>
</mat-table>

<div fxLayout fxLayoutAlign="center center" *ngIf="isLoading">
  <mat-spinner diameter="48"></mat-spinner>
</div>

<mat-paginator #paginator [length]="_workshopDataProvider.data.length" [pageIndex]="0" [pageSize]="5" [pageSizeOptions]="[5, 10, 25]"></mat-paginator>
